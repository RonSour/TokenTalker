# TokenTalker
wstalker with netty and websockets
В БД создать пару sql табличек со связями (foreign keys)
CREATE TABLE `user` (
`name` varchar(255) NOT NULL,
`email` varchar(255) NOT NULL,
`hash` varchar(255) NOT NULL,
PRIMARY KEY (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `message` (
`ts` bigint NOT NULL,
`name` varchar(255) NOT NULL,
`text` varchar(255) NOT NULL,
PRIMARY KEY (`ts`),
KEY `name` (`name`),
CONSTRAINT `message_ibfk_1` FOREIGN KEY (`name`) REFERENCES `user` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


http:9000, POST
Сделать HTTP POST эндпоинт который получает данные в json вида :
{
    name: "имя отправителя"
    password: "пароль"//hash 
}
этот эндпоинт проверяет пароль по БД и создает jwt токен (срок действия токена и алгоритм подписи не принципиален, для генерации и работе с токеном можно использовать готовую библиотечку) в токен записывает данные: name: "имя отправителя" 
и отправляет токен в ответ, тоже json вида:
{
    token: "тут сгенерированный токен" 
}
ws:9000
Сервер слушает и отвечает в какой-нибудь ws-порт (WebSocket) в него на вход поступают данные в формате json:
Сообщения клиента-пользователя:
{
    name:       "имя отправителя",
    message:    "текст сообщение"
}

Если пришло сообщение вида:
{
    name:       "имя отправителя",
    message:    "auth <токен>" // <токен> - токен получнный от эндпоинта, который создает jwt токены
}
Проверить токен, в случае успешной проверки токена, сообщения полученные от этого ws-клиента пересылать остальным клиентам подключившимся к этому серверу, а также сохранять их в БД.

Если пришло сообщение вида:
{
    name:       "имя отправителя",
    message:    "history 10"
}
проверить, что пользователь авторизован (отправлял токен) и отправить отправителю 10 последних сообщений из БД, отдельными как входящие (можно использовать promises all (порядок в таком случае будет не важен) если до этого нигде его не применили)

auth и history сообщения сохранять и пересылать разумеется не надо.

Добавить инструкцию по запуску и комментарии в коде, если изменяете формат сообщений, то подробное описание ендпоинтов и их полей.

